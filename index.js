(function(){"use strict";function l(s,t,e,i,o,n,r,c){var a=typeof s=="function"?s.options:s;return t&&(a.render=t,a.staticRenderFns=e,a._compiled=!0),{exports:s,options:a}}const d={extends:"k-field",props:{value:String,emptyText:{type:String,default:"Add Apple Music embed..."},format:{type:String,default:"embed"}},computed:{hasContent(){return this.value&&this.value.trim()!==""},previewHtml(){if(!this.value)return"";if(this.format==="embed")return this.value;if(this.format==="link"){const s=this.transformLinkToEmbedSrc(this.value);return s?`<iframe allow="autoplay *; encrypted-media *;" frameborder="0" height="150" style="width:100%;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="${s}"></iframe>`:""}return""}},methods:{transformLinkToEmbedSrc(s){return!s||typeof s!="string"||!s.startsWith("https://music.apple.com")?"":s.replace(/^https:\/\/music\.apple\.com/,"https://embed.music.apple.com")},handleSubmit(s){const t=s[this.name];if(!(this.format==="embed"?typeof t=="string"&&t.includes("<iframe")&&t.includes("embed.music.apple.com"):this.format==="link"?typeof t=="string"&&t.startsWith("https://music.apple.com/"):!1)){this.$panel.notification.error({message:this.format==="link"?"Enter a valid link (e.g. https://music.apple.com/...)":"Valid Apple Music embed not found.",timeout:4e3});return}Promise.resolve().then(()=>{this.$emit("input",t),this.$emit("change",t),this.closeDrawer(),this.$panel.notification.success({message:"Ok",timeout:4e3})}).catch(()=>{this.$panel.notification.error({message:"An error occurred",timeout:4e3})})},openDrawer(){const s={label:this.format==="link"?"Apple Music URL":"Embed Code",type:this.format==="link"?"url":"textarea",icon:this.icon==="link"?"link":"code",spellcheck:!1,autofocus:!0,help:this.help||(this.format==="link"?"Paste an Apple Music URL like https://music.apple.com...":"Paste the embed code (iframe) for a album, song, or playlist from Apple Music.")};this.format!=="link"&&(s.font="monospace",s.buttons=!1,s.size="medium",s.validate=t=>typeof t=="string"&&t.includes("<iframe")&&t.includes("embed.music.apple.com")||"Please paste valid Apple Music embed code."),this.$panel.drawer.open({component:"k-form-drawer",props:{icon:"album",title:this.label||"Apple Music Embed",value:{[this.name]:this.value},fields:{[this.name]:s}},on:{submit:this.handleSubmit.bind(this)}})},closeDrawer(){this.$panel.drawer.close()}}};var m=function(){var t=this,e=t._self._c;return e("k-field",t._b({staticClass:"k-applemusic-field"},"k-field",t.$props,!1),[e("k-button",{attrs:{slot:"options",icon:"edit-line",size:"xs",variant:"filled"},on:{click:t.openDrawer},slot:"options"},[t._v("Edit...")]),t.hasContent?t._e():e("div",{staticClass:"k-applemusic-empty"},[e("k-grid",{staticStyle:{"--columns":"1",gap:"0.5rem"}},[e("k-empty",{attrs:{text:t.emptyText,icon:"album"},on:{click:t.openDrawer}})],1)],1),e("div",{staticClass:"k-applemusic-preview",domProps:{innerHTML:t._s(t.previewHtml)}})],1)},p=[],f=l(d,m,p);const g=f.exports,v={created(){var s;console.log("[AppleMusicBlock] format:",this.format),console.log("[AppleMusicBlock] value:",(s=this.content)==null?void 0:s.apple_music)},computed:{hasContent(){var s,t;return((t=(s=this.content)==null?void 0:s.apple_music)==null?void 0:t.length)>0},format(){var t;const s=(t=this.content)==null?void 0:t.format;return typeof s=="string"?s:s===!0?"link":"embed"},hasErrors(){var t;const s=((t=this.content)==null?void 0:t.apple_music)||"";return s?this.format==="embed"?!s.includes("<iframe"):this.format==="link"?!/^https:\/\/music\.apple\.com\/.+/.test(s):!0:!1},previewHtml(){var t;const s=((t=this.content)==null?void 0:t.apple_music)||"";return s?this.format==="embed"?s:this.format==="link"?`<iframe 
					allow="autoplay *; encrypted-media *;" 
					frameborder="0" 
					height="150" 
					style="width:100%;overflow:hidden;background:transparent;" 
					sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" 
					src="${s.replace(/^https:\/\/music\.apple\.com/,"https://embed.music.apple.com")}"></iframe>`:"":""}}};var b=function(){var t=this,e=t._self._c;return e("div",{staticClass:"k-applemusic-preview"},[t.hasContent&&!t.hasErrors?[e("k-html-field-preview",{attrs:{value:t.previewHtml}})]:t.hasErrors?[e("k-grid",{staticStyle:{"--columns":"1",gap:"0.5rem"}},[e("k-box",{attrs:{theme:"warning",icon:"alert",text:`Invalid Apple Music ${t.format==="embed"?"embed":"link"}`}})],1)]:[e("k-empty",{attrs:{icon:"album",text:"Add an Apple Music embed..."}})]],2)},w=[],k=l(v,b,w);const y=k.exports,_={name:"Configure Apple Music",props:{appName:String,appBuild:String,hasToken:Boolean,status:String,missing:Array,errors:Array},data(){return{loading:!0,busy:!1,localStatus:this.status??null,localMissing:this.missing??[],localErrors:this.errors??[]}},computed:{emptyText(){return this.localStatus==="unconfigured"?"Apple Music is not fully configured yet":"Invalid Apple Music configuration"}},async created(){try{const t=await(await fetch(`${window.location.origin}/applemusic/config-status`,{credentials:"same-origin",headers:{Accept:"application/json"}})).json();this.localStatus=t.status,this.localMissing=t.missing||[],this.localErrors=t.errors||[]}finally{this.loading=!1}},methods:{redirectAuth(){},reload(){this.$reload()}}};var C=function(){var t=this,e=t._self._c;return e("k-panel-inside",[e("k-view",{staticClass:"k-musickit-config-view"},[e("k-header",{staticClass:"k-site-view-header"},[t._v(" Configure Apple Music "),e("k-button-group",{attrs:{slot:"buttons"},slot:"buttons"},[e("k-button",{attrs:{variant:"filled",theme:"blue-icon",icon:"document",size:"xs",link:"https://github.com/scottboms/kirby-applemusic/blob/main/README.md",target:"_blank",responsive:"true",text:"Setup Guide"}})],1)],1),t.loading?e("k-box",{attrs:{icon:"loader"}},[t._v("Checking configuration...")]):e("k-box",{attrs:{icon:"settings",text:t.emptyText,theme:"warning"}}),!t.loading&&t.localStatus!=="ok"?e("k-grid",{staticStyle:{"--columns":"1",gap:"0"}},[e("k-box",{staticStyle:{"margin-top":"var(--spacing-2)"},attrs:{theme:"text"}},[e("k-text",{attrs:{theme:"text"}},[e("h1",[t._v("Errors")]),e("ul",[t.localMissing.length?e("li",[t._v("Missing required configuration settings â€” "),e("strong",[t._v(t._s(t.localMissing.join(", ")))])]):t._e(),t._l(t.localErrors,function(i){return e("li",{key:i},[t._v(t._s(i))])})],2),e("p",[t._v("Correct these settings in "),e("code",[t._v("env.php")]),t._v(" under "),e("code",[t._v("scottboms.applemusic.*")]),t._v(". Review the Setup Guide for further information.")])])],1)],1):t._e()],1)],1)},S=[],x=l(_,C,S);const M=x.exports;function h({url:s,onCopy:t,onEmbed:e,onError:i}){return s?[{icon:"headphones",text:"Listen",click:()=>window.open(s,"_blank")},"-",{icon:"url",text:"Copy Link",click:()=>t==null?void 0:t(s)},{icon:"code",text:"Embed Code",click:()=>{try{const o=e==null?void 0:e(s);if(!o)throw new Error("No embed");t==null||t(o,"Embed copied to clipboard")}catch{i==null||i("Could not create embed code")}}}]:[]}const T={name:"Apple Music",props:{appName:String,appBuild:String,hasToken:Boolean,storefront:String,songsLimit:{type:Number,default:15}},data(){return{busy:!1,msg:this.hasToken?"Token saved.":"Not connected yet.",items:[],loading:!1,error:null,limit:this.songsLimit,offset:0,language:"en-US",storefrontInfo:null,searchQuery:"",searchType:"songs",searchResults:[],searching:!1,searchError:null,searchLimit:10,_searchTimer:null}},created(){this.hasToken&&(this.fetchStorefront(),this.fetchRecent())},watch:{hasToken(s){s?(this.fetchStorefront(),this.fetchRecent()):(this.items=[],this.error=null,this.loading=!1,this.storefrontInfo=null,this.searchQuery="",this.searchResults=[],this.searching=!1,this.searchError=null)}},computed:{headerTitle(){return this.hasToken?"Apple Music":"Authorize Apple Music"},searchResultItems(){var e;const s=(((e=this.storefrontInfo)==null?void 0:e.id)||this.storefront||"us").toString().toLowerCase(),t=s==="auto"?"us":s;return(this.searchResults||[]).map(i=>{const o=i.kind||this.searchType,n=o==="albums"||o==="album"?"album":"song",r=i!=null&&i.id?`https://music.apple.com/${t}/${n}/${encodeURIComponent(i.id)}`:null,c={id:i.id,text:i.text,info:i.info,icon:n==="album"?"album":"music",...i.image?{image:{src:i.image,ratio:"1/1",cover:!0,back:"pattern"}}:{},...i.link?{link:i.link}:{}};if(n==="album"&&i.id&&(c.link=`applemusic/albums/${encodeURIComponent(i.id)}`),r){const a=h({url:r,onCopy:(u,K="Link copied to clipboard")=>this.copyToClipboard(u,K),onEmbed:u=>this.buildEmbedCode(u),onError:u=>this.notify("error",u)});a.length&&(c.options=a)}return c})},searchTypeOptions(){return[{value:"songs",text:"Songs"},{value:"albums",text:"Albums"}]},collectionItems(){return(this.items||[]).map(s=>{const t=this.trackUrl(s),e=typeof s.id=="string"&&s.id.startsWith("i."),i={id:s.id,text:this.trackTitle(s),info:this.artistName(s),image:{src:this.artworkUrl(s,300)||void 0,ratio:"1/1",cover:!0,back:"pattern"},icon:"music",title:this.trackSubtitle(s),...e?{}:{link:"applemusic/song/"+s.id}};if(t){const o=h({url:t,onCopy:(n,r="Link copied to clipboard")=>this.copyToClipboard(n,r),onEmbed:n=>this.buildEmbedCode(n),onError:n=>this.notify("error",n)});o.length&&(i.options=o)}return i})},statReports(){const s=[{label:"Version "+this.appBuild,value:this.appName,icon:"layers",info:"Build Info",theme:"info"}];return this.storefrontInfo&&s.push({label:"Storefront",value:this.storefrontInfo.id,icon:"store",info:this.storefrontInfo.language,theme:this.storefrontInfo.id?"positive":"warning"}),s}},mounted(){(async()=>{try{await this.loadMusicKit(this.cspNonce);const s=await fetch("/applemusic/dev-token",{credentials:"same-origin"});if(!s.ok)throw new Error("dev-token "+s.status);const{token:t}=await s.json(),e=(this.storefront||"auto").toLowerCase(),i={developerToken:t,app:{name:this.appName||"KirbyMusicKit",build:this.appBuild||"2.0.0"}};e!=="auto"&&(i.storefrontId=e),window.MusicKit.configure(i)}catch{this.notify("error","Failed to prepare Apple Music (CSP/network/dev token)")}})(),(async()=>{try{const s=await fetch("/applemusic/has-token",{credentials:"same-origin"});if(s.ok){const{hasToken:t}=await s.json();this.hasToken=!!t}}catch(s){console.warn("has-token check failed:",s)}})();try{const s=new URL(window.location.href);s.searchParams.get("connected")==="1"&&(this.notify("success","Connected â€” token saved."),s.searchParams.delete("connected"),window.history.replaceState({},"",s.toString()))}catch{}},methods:{onSearchInput(s){if(this.searchQuery=s||"",clearTimeout(this._searchTimer),!this.searchQuery.trim()){this.searchResults=[],this.searchError=null;return}this._searchTimer=setTimeout(()=>this.performSearch(this.searchQuery),400)},async performSearch(s){var e;const t=(typeof s=="string"?s:this.searchQuery).trim();if(t)try{this.searching=!0,this.searchError=null;const i=(((e=this.storefrontInfo)==null?void 0:e.id)||this.storefront||"us").toString().toLowerCase(),o=i==="auto"?"us":i,r=`/applemusic/search?${new URLSearchParams({q:t,limit:String(this.searchLimit),language:this.language,sf:o,type:this.searchType}).toString()}`,c=await fetch(r,{credentials:"same-origin"}),a=await c.json();if(!c.ok||!a.ok)throw new Error((a==null?void 0:a.error)||`HTTP ${c.status}`);this.searchResults=a.results}catch(i){this.searchResults=[],this.searchError=(i==null?void 0:i.message)||"Search failed",this.notify("error",this.searchError)}finally{this.searching=!1}},onSearchTypeChange(s){var t;this.searchType=s||"songs",(t=this.searchQuery)!=null&&t.trim()&&this.performSearch()},async copyToClipboard(s,t="Copied"){var e;try{if(!s)throw new Error("Nothing to copy");if((e=navigator.clipboard)!=null&&e.writeText)await navigator.clipboard.writeText(s);else{const i=document.createElement("textarea");i.value=s,i.setAttribute("readonly",""),i.style.position="fixed",i.style.opacity="0",document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i)}this.notify("success",t)}catch(i){console.warn("copyToClipboard failed:",i),this.notify("error","Could not copy to clipboard")}},toEmbedUrl(s){var t;try{const e=new URL(s);if(!/apple\.com$/i.test(e.hostname))return null;e.hostname="embed.music.apple.com";const i=e.pathname.split("/").filter(Boolean);if(!(i.length>0&&/^[a-z]{2}$/i.test(i[0]))){const n=(((t=this.storefrontInfo)==null?void 0:t.id)||this.storefront||"us").toString().toLowerCase();i.unshift(n),e.pathname="/"+i.join("/")}return e.toString()}catch{return null}},buildEmbedCode(s){const t=this.toEmbedUrl(s);return t?`<iframe allow="autoplay *; encrypted-media *;" frameborder="0" height="150" style="width:100%;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="${t}"></iframe>`:null},async loadMusicKit(s){var t,e;(t=window.MusicKit)!=null&&t.getInstance||(document.querySelector("script[data-am-mk]")?(e=window.MusicKit)!=null&&e.getInstance||await new Promise(i=>{window.addEventListener("musickitloaded",i,{once:!0}),setTimeout(i,50)}):await new Promise((i,o)=>{const n=document.createElement("script");n.src="https://js-cdn.music.apple.com/musickit/v3/musickit.js",n.async=!0,n.dataset.amMk="1",s&&n.setAttribute("nonce",s),n.onerror=o,document.head.appendChild(n);let r=!1,c=!1;const a=()=>{r&&c&&i()};n.onload=()=>{r=!0,a()},window.addEventListener("musickitloaded",()=>{c=!0,a()},{once:!0})}))},async redirectAuth(){try{this.busy=!0,this.notify("info","Redirecting to Apple Music sign-inâ€¦");const s=(this.storefront||"auto").toLowerCase(),t=window.location.href,e=`/applemusic/auth?sf=${encodeURIComponent(s)}&returnTo=${encodeURIComponent(t)}`;window.location.assign(e)}catch{this.notify("error","Could not start sign-in")}},async popupAuth(){try{this.busy=!0,this.notify("info","Opening Apple Musicâ€¦");const s=(this.storefront||"").toLowerCase(),t=s?`/applemusic/auth?sf=${encodeURIComponent(s)}`:"/musickit/auth",e=window.open(t,"amPopup","width=480,height=600"),i=async o=>{if(o.origin!==window.location.origin)return;const n=o.data||{};if(n.type==="musickit-token"){window.removeEventListener("message",i),n.ok?(this.notify("success","Connected â€” token saved"),this.hasToken=!0):(console.error("Popup failed:",n.error,n.detail||""),this.notify("warning","Authorization cancelled or failed"));try{e&&e.close()}catch{}this.busy=!1}};window.addEventListener("message",i),setTimeout(()=>{try{(!e||e.closed)&&(window.removeEventListener("message",i),this.busy=!1,this.notify("info","Popup closed"))}catch{}},6e4)}catch(s){console.error("popupAuth error:",s),this.notify("error","Could not open popup"),this.busy=!1}},async refreshDevToken(){var s,t;try{const e=await fetch("/applemusic/dev-token/refresh",{method:"POST",credentials:"same-origin",headers:{Accept:"application/json"}});if(!e.ok){const r=await e.text();throw new Error(`HTTP ${e.status}: ${r.slice(0,200)}`)}const{token:i}=await e.json();if(!i)throw new Error("No token returned");const o=(this.storefront||"auto").toLowerCase(),n={developerToken:i,app:{name:this.appName||"KirbyMusicKit",build:this.appBuild||"dev"}};if(o&&o!=="auto"&&(n.storefrontId=o),!window.MusicKit)throw new Error("MusicKit SDK not loaded");window.MusicKit.configure(n);try{window.MusicKit.getInstance()}catch{}this.notify("success","Developer token refreshed"),this.hasToken&&((s=this.fetchStorefront)==null||s.call(this),(t=this.fetchRecent)==null||t.call(this))}catch(e){console.error("refreshDevToken failed:",e),this.notify("error",`Could not refresh dev token: ${e.message||e}`)}},async disconnect(){var s,t;try{if(!confirm("Disconnect Apple Music for this Panel user?"))return;this.busy=!0,this.notify("info","Disconnecting...");try{await this.loadMusicKit(this.cspNonce);const i=(t=(s=window.MusicKit)==null?void 0:s.getInstance)==null?void 0:t.call(s);i!=null&&i.isAuthorized&&await i.unauthorize()}catch(i){console.warn("unauthorize() skipped/failed:",i)}const e=await fetch("/applemusic/delete-user-token",{method:"POST",credentials:"same-origin"});if(!e.ok)throw new Error("delete-token "+e.status);this.hasToken=!1,this.notify("success","Disconnected â€” saved token removed")}catch(e){console.error("disconnect() error:",e),this.notify("error","Could not disconnect â€” see console for details")}finally{this.busy=!1}},async fetchStorefront(){var s,t;try{const e=new URLSearchParams({language:this.language}).toString(),i=await fetch(`/applemusic/storefront?${e}`,{credentials:"same-origin"});if(!i.ok)throw new Error("storefront "+i.status);const o=await i.json(),n=((s=o==null?void 0:o.data)==null?void 0:s[0])||{};this.storefrontInfo={id:n.id||null,language:((t=n.attributes)==null?void 0:t.defaultLanguageTag)||null}}catch{this.storefrontInfo=null,this.notify("info","Could not load storefront")}},async fetchRecent(s={}){this.loading=!0,this.error=null;const t={limit:s.limit??this.limit,offset:s.offset??this.offset,language:this.language};try{const e=new URLSearchParams({limit:String(t.limit),offset:String(t.offset),language:t.language}).toString(),o=await(await fetch(`/applemusic/recent?${e}`,{credentials:"same-origin"})).json();this.items=Array.isArray(o==null?void 0:o.data)?o.data:[],this.limit=t.limit,this.offset=t.offset}catch(e){this.error=(e==null?void 0:e.message)||"Failed to load recently played tracks"}finally{this.loading=!1}},nextPage(){this.fetchRecent({offset:this.offset+this.limit})},prevPage(){this.fetchRecent({offset:Math.max(0,this.offset-this.limit)})},artworkUrl(s,t=100){var i;const e=(i=s==null?void 0:s.attributes)==null?void 0:i.artwork;return e!=null&&e.url?e.url.replace("{w}",t).replace("{h}",t):null},trackTitle(s){var t;return((t=s==null?void 0:s.attributes)==null?void 0:t.name)||"Untitled"},trackSubtitle(s){var i,o;const t=(i=s==null?void 0:s.attributes)==null?void 0:i.artistName,e=(o=s==null?void 0:s.attributes)==null?void 0:o.albumName;return[t,e].filter(Boolean).join(" â€” ")},artistName(s){var t;return(t=s==null?void 0:s.attributes)==null?void 0:t.artistName},albumName(s){var t;return((t=s==null?void 0:s.attributes)==null?void 0:t.albumName)||"Untitled"},trackUrl(s){var t;return((t=s==null?void 0:s.attributes)==null?void 0:t.url)||null},notify(s,t){var i;const e=this.$panel||((i=this.$root)==null?void 0:i.$panel);if(e!=null&&e.notification){if(typeof e.notification[s]=="function"){e.notification[s](t);return}if(typeof e.notification.create=="function"){e.notification.create({message:t,type:s});return}}console[s==="error"?"error":"log"](`[${s}] ${t}`)}}};var $=function(){var t=this,e=t._self._c;return e("k-panel-inside",[e("k-view",{staticClass:"k-musickit-auth"},[e("k-header",{staticClass:"k-site-view-header"},[t._v(" "+t._s(t.headerTitle)+" "),e("k-button-group",{attrs:{slot:"buttons"},slot:"buttons"},[e("k-button",{attrs:{variant:"filled",theme:"blue-icon",icon:"document",size:"xs",link:"https://github.com/scottboms/kirby-applemusic/blob/main/README.md",target:"_blank",responsive:"true",text:"Setup Guide"}}),t.hasToken?t._e():e("k-button",{attrs:{disabled:t.busy,variant:"filled",theme:"green-icon",icon:"open",size:"xs"},on:{click:t.redirectAuth}},[t._v(" "+t._s(t.hasToken?"Re-authorize Apple Music":"Authorize Apple Music")+" ")]),t.hasToken?e("k-button",{attrs:{disabled:t.busy,variant:"filled",icon:"reset-token",text:"Reset Token",size:"xs",title:"Reset the Cached Token"},on:{click:t.refreshDevToken}}):t._e(),t.hasToken?e("k-button",{attrs:{disabled:t.busy,variant:"filled",theme:"red-icon",icon:"logout",text:"Disconnect",size:"xs",title:"Delete the Saved Token"},on:{click:t.disconnect}}):t._e()],1)],1),t.hasToken?t._e():e("k-box",{staticStyle:{"margin-bottom":".5rem"},attrs:{theme:"positive",icon:"settings"}},[t._v(" Your configuration is ready to connect to your Apple Music account. ")]),e("k-section",[e("k-stats",{staticClass:"k-musickit-info-reports",attrs:{reports:t.statReports,size:"small"}})],1),t.hasToken?[e("k-section",[e("k-box",{staticStyle:{"margin-bottom":"var(--spacing-1)"},attrs:{icon:"search",theme:"white"}},[e("k-select-field",{staticStyle:{"min-width":"9rem"},attrs:{value:t.searchType,options:t.searchTypeOptions,disabled:!t.hasToken,icon:"angle-down",size:"tiny"},on:{input:t.onSearchTypeChange}}),e("k-search-input",{staticStyle:{"min-width":"80%"},attrs:{value:t.searchQuery,disabled:!t.hasToken,placeholder:"Search Apple Music..."},on:{input:t.onSearchInput,submit:t.performSearch}})],1),t.searching?e("k-box",{staticStyle:{"--width":"100%"},attrs:{icon:"loader"}},[t._v("Searching...")]):t.searchResults.length?e("k-items",{attrs:{items:t.searchResultItems,layout:"list",size:"small"}}):t.searchQuery&&!t.searching?e("k-box",{attrs:{theme:"none"}},[t._v("No matches found")]):t._e()],1),e("k-section",{attrs:{label:"Recently Played Tracks"}},[e("k-button",{attrs:{slot:"options",size:"xs",variant:"filled",icon:"refresh"},on:{click:function(i){return t.fetchRecent()}},slot:"options"}),t.error?e("k-box",{attrs:{theme:"negative"}},[t._v(t._s(t.error))]):t.loading?e("k-box",{attrs:{icon:"loader"}},[t._v("Loading...")]):e("div",[e("k-collection",{attrs:{items:t.collectionItems,layout:"cards",size:"large"}}),t.items.length===0?e("div",[t._v(" No items returned. ")]):t._e()],1),e("k-box",{staticStyle:{"margin-top":"1rem"},attrs:{theme:"none"}},[e("k-button-group",{attrs:{responsive:"true",theme:"gray-icon"}},[e("k-button",{attrs:{variant:"filled",size:"xs",title:"Previous Page",icon:"angle-left",disabled:t.offset<=0},on:{click:t.prevPage}}),e("k-button",{attrs:{variant:"filled",size:"xs",title:"Next Page",icon:"angle-right",disabled:t.items.length<t.limit},on:{click:t.nextPage}})],1)],1)],1)]:t._e()],2)],1)},A=[],R=l(T,$,A);const L=R.exports,I={name:"Apple Music - Song Details",props:{songId:String,language:String},data(){return{loading:!0,err:null,song:null}},async created(){try{const s=`/applemusic/song/${encodeURIComponent(this.songId)}?l=${encodeURIComponent(this.language||"en-US")}`,t=await fetch(s,{credentials:"same-origin",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const e=await t.json();this.song=e}catch(s){this.err=(s==null?void 0:s.message)||"Failed to load song"}finally{this.loading=!1}},methods:{back(){this.$go("applemusic")}}};var E=function(){var i,o;var t=this,e=t._self._c;return e("k-panel-inside",[e("k-view",[e("k-header",{staticClass:"k-site-view-header",scopedSlots:t._u([{key:"buttons",fn:function(){var n;return[(n=t.song)!=null&&n.url?e("k-button",{attrs:{icon:"headphones",link:t.song.url,target:"_blank",theme:"blue-icon",variant:"filled"}},[t._v("Listen in Apple Music")]):t._e()]},proxy:!0}])},[t._v(" "+t._s(((i=t.song)==null?void 0:i.name)||"Song")+" ")]),t.loading?e("k-box",{attrs:{icon:"loader"}},[t._v("Loading...")]):t.err?e("k-box",{attrs:{theme:"negative",icon:"alert"}},[t._v(t._s(t.err))]):e("k-section",[e("k-grid",{staticStyle:{gap:"0","--columns":"12",background:"var(--item-color-back)","border-radius":"var(--rounded)","box-shadow":"var(--shadow)"}},[t.song.image?e("k-image-frame",{staticStyle:{"border-radius":"var(--rounded)","--width":"1/2"},attrs:{src:t.song.image,alt:t.song.name,ratio:"1/1",back:"pattern",cover:"true",icon:"music"}}):t._e(),e("k-box",{staticStyle:{"--width":"1/2"}},[e("div",{staticClass:"k-text",staticStyle:{padding:"var(--spacing-8)"}},[t.song.artistName?e("p",{staticClass:"am-songArtist"},[t._v(t._s(t.song.artistName))]):t._e(),t.song.albumName?e("p",{staticClass:"am-songAlbum"},[t._v(t._s(t.song.albumName)+" ("+t._s(t.song.releaseYear)+")")]):t._e(),t.song.duration?e("k-box",{staticClass:"am-songDuration",attrs:{icon:"clock"}},[t._v(t._s(t.song.duration))]):t._e(),t.song.previewUrl?e("k-box",[e("audio",{staticClass:"k-file-preview am-audioPreview",attrs:{src:t.song.previewUrl,controls:""}})]):t._e(),e("hr"),t.song.composerName?e("k-box",{staticClass:"am-meta am-metaSmall",attrs:{icon:"composer"}},[t._v("Written by "+t._s(t.song.composerName))]):t._e(),(o=t.song.genreNames)!=null&&o.length?e("k-box",{staticClass:"am-meta am-metaSmall",attrs:{icon:"tag"}},[t._v(t._s(t.song.genreNames.join(", ")))]):t._e(),t.song.releaseDate?e("k-box",{staticClass:"am-meta am-metaSmall",attrs:{icon:"calendar"}},[t._v(t._s(t.song.releaseDate))]):t._e()],1)])],1)],1)],1)],1)},N=[],P=l(I,E,N);const U=P.exports,H={name:"Apple Music - Album Details",props:{albumId:String,language:String},data(){return{loading:!0,err:null,album:null}},async created(){try{const s=`/applemusic/album/${encodeURIComponent(this.albumId)}?l=${encodeURIComponent(this.language||"en-US")}`,t=await fetch(s,{credentials:"same-origin",headers:{Accept:"application/json"}});if(!t.ok)throw new Error(`HTTP ${t.status}`);const e=await t.json();this.album=e}catch(s){this.err=(s==null?void 0:s.message)||"Failed to load album"}finally{this.loading=!1}},methods:{back(){this.$go("applemusic")}}};var V=function(){var i;var t=this,e=t._self._c;return e("k-panel-inside",[e("k-view",[e("k-header",{staticClass:"k-site-view-header",scopedSlots:t._u([{key:"buttons",fn:function(){var o;return[(o=t.album)!=null&&o.url?e("k-button",{attrs:{icon:"headphones",link:t.album.url,target:"_blank",theme:"blue-icon",variant:"filled"}},[t._v("Listen in Apple Music")]):t._e()]},proxy:!0}])},[t._v(" "+t._s(((i=t.song)==null?void 0:i.name)||"Song")+" ")]),t.loading?e("k-box",{attrs:{icon:"loader"}},[t._v("Loading...")]):t.err?e("k-box",{attrs:{theme:"negative",icon:"alert"}},[t._v(t._s(t.err))]):e("k-section",[e("k-grid",{staticStyle:{gap:"0","--columns":"12",background:"var(--item-color-back)","border-radius":"var(--rounded)","box-shadow":"var(--shadow)"}},[t.album.image?e("k-image-frame",{staticStyle:{"border-radius":"var(--rounded)","--width":"1/2"},attrs:{src:t.song.image,alt:t.album.name,ratio:"1/1",back:"pattern",cover:"true",icon:"music"}}):t._e(),e("k-box",{staticStyle:{"--width":"1/2"}},[e("div",{staticClass:"k-text",staticStyle:{padding:"var(--spacing-8)"}},[t.album.artistName?e("p",{staticClass:"am-albumArtist"},[t._v(t._s(t.album.artistName))]):t._e(),t.album.albumName?e("p",{staticClass:"am-albumAlbum"},[t._v(t._s(t.album.albumName)+" ("+t._s(t.album.releaseYear)+")")]):t._e()])])],1)],1)],1)],1)},z=[],D=l(H,V,z);const Z=D.exports,B={album:'<svg id="a" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.5,5.5v9.5c0,1.38-1.12,2.5-2.5,2.5s-2.5-1.12-2.5-2.5,1.12-2.5,2.5-2.5c.17,0,.34.02.5.05v-4.65l-6,.6v7.5c0,1.38-1.12,2.5-2.5,2.5s-2.5-1.12-2.5-2.5,1.12-2.5,2.5-2.5c.17,0,.34.02.5.05v-7.05l10-1Z"/><path d="M23,20V4c0-1.66-1.34-3-3-3H4c-1.66,0-3,1.34-3,3v16c0,1.66,1.34,3,3,3h16c1.66,0,3-1.34,3-3ZM4,21c-.55,0-1-.45-1-1V4c0-.55.45-1,1-1h16c.55,0,1,.45,1,1v16c0,.55-.45,1-1,1H4Z"/></svg>',"album-filled":'<svg id="a" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17.5,5.5v9.5c0,1.38-1.12,2.5-2.5,2.5s-2.5-1.12-2.5-2.5,1.12-2.5,2.5-2.5c.17,0,.34.02.5.05v-4.65l-6,.6v7.5c0,1.38-1.12,2.5-2.5,2.5s-2.5-1.12-2.5-2.5,1.12-2.5,2.5-2.5c.17,0,.34.02.5.05v-7.05l10-1ZM23,20V4c0-1.66-1.34-3-3-3H4c-1.66,0-3,1.34-3,3v16c0,1.66,1.34,3,3,3h16c1.66,0,3-1.34,3-3Z"/></svg>',composer:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C17.5228 2 22 6.47715 22 12C22 17.5228 17.5228 22 12 22C6.47715 22 2 17.5228 2 12C2 6.47715 6.47715 2 12 2ZM12.1597 16C10.1243 16 8.29182 16.8687 7.01276 18.2556C8.38039 19.3474 10.114 20 12 20C13.9695 20 15.7727 19.2883 17.1666 18.1081C15.8956 16.8074 14.1219 16 12.1597 16ZM12 4C7.58172 4 4 7.58172 4 12C4 13.8106 4.6015 15.4807 5.61557 16.8214C7.25639 15.0841 9.58144 14 12.1597 14C14.6441 14 16.8933 15.0066 18.5218 16.6342C19.4526 15.3267 20 13.7273 20 12C20 7.58172 16.4183 4 12 4ZM12 5C14.2091 5 16 6.79086 16 9C16 11.2091 14.2091 13 12 13C9.79086 13 8 11.2091 8 9C8 6.79086 9.79086 5 12 5ZM12 7C10.8954 7 10 7.89543 10 9C10 10.1046 10.8954 11 12 11C13.1046 11 14 10.1046 14 9C14 7.89543 13.1046 7 12 7Z"></path></svg>',"edit-line":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 18.89H6.41421L15.7279 9.57627L14.3137 8.16206L5 17.4758V18.89ZM21 20.89H3V16.6473L16.435 3.21231C16.8256 2.82179 17.4587 2.82179 17.8492 3.21231L20.6777 6.04074C21.0682 6.43126 21.0682 7.06443 20.6777 7.45495L9.24264 18.89H21V20.89ZM15.7279 6.74785L17.1421 8.16206L18.5563 6.74785L17.1421 5.33363L15.7279 6.74785Z"></path></svg>',headphones:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4 12H7C8.10457 12 9 12.8954 9 14V19C9 20.1046 8.10457 21 7 21H4C2.89543 21 2 20.1046 2 19V12C2 6.47715 6.47715 2 12 2C17.5228 2 22 6.47715 22 12V19C22 20.1046 21.1046 21 20 21H17C15.8954 21 15 20.1046 15 19V14C15 12.8954 15.8954 12 17 12H20C20 7.58172 16.4183 4 12 4C7.58172 4 4 7.58172 4 12Z"></path></svg>',music:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3V17C20 19.2091 18.2091 21 16 21C13.7909 21 12 19.2091 12 17C12 14.7909 13.7909 13 16 13C16.7286 13 17.4117 13.1948 18 13.5351V6H9V17C9 19.2091 7.20914 21 5 21C2.79086 21 1 19.2091 1 17C1 14.7909 2.79086 13 5 13C5.72857 13 6.41165 13.1948 7 13.5351V3H20Z"></path></svg>',"reset-token":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9 12.5 6.5 15 9 17.5 11.5 15 9 12.5ZM15 2.5C11.5724 2.5 8.76444 5.15304 8.51763 8.51763 5.15304 8.76445 2.5 11.5724 2.5 15 2.5 18.5899 5.41015 21.5 9 21.5 12.4276 21.5 15.2356 18.847 15.4824 15.4824 18.847 15.2356 21.5 12.4276 21.5 9 21.5 5.41015 18.5899 2.5 15 2.5ZM15.3234 13.4886C14.7575 11.1126 12.8874 9.24245 10.5114 8.67665 10.6772 6.34229 12.6234 4.5 15 4.5 17.4853 4.5 19.5 6.51472 19.5 9 19.5 11.3766 17.6577 13.3228 15.3234 13.4886ZM13.5 15C13.5 17.4853 11.4853 19.5 9 19.5 6.51472 19.5 4.5 17.4853 4.5 15 4.5 12.5147 6.51472 10.5 9 10.5 11.4853 10.5 13.5 12.5147 13.5 15ZM3 7C3 4.79086 4.79086 3 7 3H8.5V5H7C5.89543 5 5 5.89543 5 7V8.5H3V7ZM19 17V15.5H21V17C21 19.2091 19.2091 21 17 21H15.5V19H17C18.1046 19 19 18.1046 19 17Z"></path></svg>'};panel.plugin("scottboms/kirby-applemusic",{icons:B,components:{"k-musickit-config-view":M,"k-musickit-history-view":L,"k-musickit-song-view":U,"k-musickit-album-view":Z},fields:{applemusic:g},blocks:{applemusic:y}})})();
