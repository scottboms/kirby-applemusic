(function(){"use strict";function r(t,e,i,v,b,w,g,k){var s=typeof t=="function"?t.options:t;return e&&(s.render=e,s.staticRenderFns=i,s._compiled=!0),{exports:t,options:s}}const a={extends:"k-field",props:{value:String,emptyText:{type:String,default:"Add Apple Music embed..."},format:{type:String,default:"embed"}},computed:{hasContent(){return this.value&&this.value.trim()!==""},previewHtml(){if(!this.value)return"";if(this.format==="embed")return this.value;if(this.format==="link"){const t=this.transformLinkToEmbedSrc(this.value);return t?`<iframe allow="autoplay *; encrypted-media *;" frameborder="0" height="150" style="width:100%;overflow:hidden;background:transparent;" sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" src="${t}"></iframe>`:""}return""}},methods:{transformLinkToEmbedSrc(t){return!t||typeof t!="string"||!t.startsWith("https://music.apple.com")?"":t.replace(/^https:\/\/music\.apple\.com/,"https://embed.music.apple.com")},handleSubmit(t){const e=t[this.name];if(!(this.format==="embed"?typeof e=="string"&&e.includes("<iframe")&&e.includes("embed.music.apple.com"):this.format==="link"?typeof e=="string"&&e.startsWith("https://music.apple.com/"):!1)){this.$panel.notification.error({message:this.format==="link"?"Enter a valid link (e.g. https://music.apple.com/...)":"Valid Apple Music embed not found.",timeout:4e3});return}Promise.resolve().then(()=>{this.$emit("input",e),this.$emit("change",e),this.closeDrawer(),this.$panel.notification.success({message:"Ok",timeout:4e3})}).catch(()=>{this.$panel.notification.error({message:"An error occurred",timeout:4e3})})},openDrawer(){const t={label:this.format==="link"?"Apple Music URL":"Embed Code",type:this.format==="link"?"url":"textarea",icon:this.icon==="link"?"link":"code",spellcheck:!1,autofocus:!0,help:this.help||(this.format==="link"?"Paste an Apple Music URL like https://music.apple.com...":"Paste the embed code (iframe) for a album, song, or playlist from Apple Music.")};this.format!=="link"&&(t.font="monospace",t.buttons=!1,t.size="medium",t.validate=e=>typeof e=="string"&&e.includes("<iframe")&&e.includes("embed.music.apple.com")||"Please paste valid Apple Music embed code."),this.$panel.drawer.open({component:"k-form-drawer",props:{icon:"album",title:this.label||"Apple Music Embed",value:{[this.name]:this.value},fields:{[this.name]:t}},on:{submit:this.handleSubmit.bind(this)}})},closeDrawer(){this.$panel.drawer.close()}}};var o=function(){var e=this,i=e._self._c;return i("k-field",e._b({staticClass:"k-applemusic-field"},"k-field",e.$props,!1),[i("k-button",{attrs:{slot:"options",icon:"edit-line",size:"xs",variant:"filled"},on:{click:e.openDrawer},slot:"options"},[e._v("Edit...")]),e.hasContent?e._e():i("div",{staticClass:"k-applemusic-empty"},[i("k-grid",{staticStyle:{"--columns":"1",gap:"0.5rem"}},[i("k-empty",{attrs:{text:e.emptyText,icon:"album"},on:{click:e.openDrawer}})],1)],1),i("div",{staticClass:"k-applemusic-preview",domProps:{innerHTML:e._s(e.previewHtml)}})],1)},n=[],l=r(a,o,n);const c=l.exports,p={created(){var t;console.log("[AppleMusicBlock] format:",this.format),console.log("[AppleMusicBlock] value:",(t=this.content)==null?void 0:t.apple_music)},computed:{hasContent(){var t,e;return((e=(t=this.content)==null?void 0:t.apple_music)==null?void 0:e.length)>0},format(){var e;const t=(e=this.content)==null?void 0:e.format;return typeof t=="string"?t:t===!0?"link":"embed"},hasErrors(){var e;const t=((e=this.content)==null?void 0:e.apple_music)||"";return t?this.format==="embed"?!t.includes("<iframe"):this.format==="link"?!/^https:\/\/music\.apple\.com\/.+/.test(t):!0:!1},previewHtml(){var e;const t=((e=this.content)==null?void 0:e.apple_music)||"";return t?this.format==="embed"?t:this.format==="link"?`<iframe 
					allow="autoplay *; encrypted-media *;" 
					frameborder="0" 
					height="150" 
					style="width:100%;overflow:hidden;background:transparent;" 
					sandbox="allow-forms allow-popups allow-same-origin allow-scripts allow-storage-access-by-user-activation allow-top-navigation-by-user-activation" 
					src="${t.replace(/^https:\/\/music\.apple\.com/,"https://embed.music.apple.com")}"></iframe>`:"":""}}};var m=function(){var e=this,i=e._self._c;return i("div",{staticClass:"k-applemusic-preview"},[e.hasContent&&!e.hasErrors?[i("k-html-field-preview",{attrs:{value:e.previewHtml}})]:e.hasErrors?[i("k-grid",{staticStyle:{"--columns":"1",gap:"0.5rem"}},[i("k-box",{attrs:{theme:"warning",icon:"alert",text:`Invalid Apple Music ${e.format==="embed"?"embed":"link"}`}})],1)]:[i("k-empty",{attrs:{icon:"album",text:"Add an Apple Music embed..."}})]],2)},u=[],d=r(p,m,u);const f=d.exports,h={album:'<svg id="a" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M22,1H2c-.55,0-1,.45-1,1v20c0,.55.45,1,1,1h20c.55,0,1-.45,1-1V2c0-.55-.45-1-1-1ZM3,21V3h18v18H3Z"/><path d="M16,6v2h-3v7.5c0,1.38-1.12,2.5-2.5,2.5s-2.5-1.12-2.5-2.5,1.12-2.5,2.5-2.5c.17,0,.34.02.5.05v-7.05h5Z"/></svg>',music:'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M20 3V17C20 19.2091 18.2091 21 16 21C13.7909 21 12 19.2091 12 17C12 14.7909 13.7909 13 16 13C16.7286 13 17.4117 13.1948 18 13.5351V6H9V17C9 19.2091 7.20914 21 5 21C2.79086 21 1 19.2091 1 17C1 14.7909 2.79086 13 5 13C5.72857 13 6.41165 13.1948 7 13.5351V3H20Z"></path></svg>',"edit-line":'<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M5 18.89H6.41421L15.7279 9.57627L14.3137 8.16206L5 17.4758V18.89ZM21 20.89H3V16.6473L16.435 3.21231C16.8256 2.82179 17.4587 2.82179 17.8492 3.21231L20.6777 6.04074C21.0682 6.43126 21.0682 7.06443 20.6777 7.45495L9.24264 18.89H21V20.89ZM15.7279 6.74785L17.1421 8.16206L18.5563 6.74785L17.1421 5.33363L15.7279 6.74785Z"></path></svg>'};panel.plugin("scottboms/kirby-applemusic",{icons:h,fields:{applemusic:c},blocks:{applemusic:f}})})();
